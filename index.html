<html>
	<head>
		<style>
			body {
				background-color: var(--figma-color-bg);
				color: var(--figma-color-text);
			}

			.icons-grid {
				display: flex;
				flex-wrap: wrap;
			}

			.icon {
				border-radius: 4px;
				cursor: grab;
				height: 24px;
				margin: 4px;
				padding: 4px;
				width: 24px;
			}

			.icon:hover {
				background-color: #ddd;
			}
		</style>
	</head>
	<body>
		<div class="icons-grid">
			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-activity"
				>
					<polyline
						points="22 12 18 12 15 21 9 3 6 12 2 12"
					></polyline>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-airplay"
				>
					<path
						d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"
					></path>
					<polygon points="12 15 17 21 7 21 12 15"></polygon>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-alert-circle"
				>
					<circle
						cx="12"
						cy="12"
						r="10"
					></circle>
					<line
						x1="12"
						y1="8"
						x2="12"
						y2="12"
					></line>
					<line
						x1="12"
						y1="16"
						x2="12.01"
						y2="16"
					></line>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-align-center"
				>
					<line
						x1="18"
						y1="10"
						x2="6"
						y2="10"
					></line>
					<line
						x1="21"
						y1="6"
						x2="3"
						y2="6"
					></line>
					<line
						x1="21"
						y1="14"
						x2="3"
						y2="14"
					></line>
					<line
						x1="18"
						y1="18"
						x2="6"
						y2="18"
					></line>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-anchor"
				>
					<circle
						cx="12"
						cy="5"
						r="3"
					></circle>
					<line
						x1="12"
						y1="22"
						x2="12"
						y2="8"
					></line>
					<path d="M5 12H2a10 10 0 0 0 20 0h-3"></path>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-arrow-left-circle"
				>
					<circle
						cx="12"
						cy="12"
						r="10"
					></circle>
					<polyline points="12 8 8 12 12 16"></polyline>
					<line
						x1="16"
						y1="12"
						x2="8"
						y2="12"
					></line>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-bar-chart"
				>
					<line
						x1="12"
						y1="20"
						x2="12"
						y2="10"
					></line>
					<line
						x1="18"
						y1="20"
						x2="18"
						y2="4"
					></line>
					<line
						x1="6"
						y1="20"
						x2="6"
						y2="16"
					></line>
				</svg>
			</span>

			<span
				class="icon"
				draggable="true"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="feather feather-bluetooth"
				>
					<polyline
						points="6.5 6.5 17.5 17.5 12 23 12 1 17.5 6.5 6.5 17.5"
					></polyline>
				</svg>
			</span>
		</div>
		<h2>Rectangle Creator</h2>
		<p>
			Count:
			<input
				id="count"
				value="5"
			/>
		</p>
		<button id="create">Create</button>
		<button id="cancel">Cancel</button>
		<button id="signin">Sign In</button>
	</body>
	<script>
		const icons = document.getElementsByClassName('icon');

		for (const icon of icons) {
			icon.addEventListener('dragstart', (e) => {
				e.dataTransfer.setData('image/svg+xml', e.target.innerHTML);
			});
		}
	</script>
	<script>
		document.getElementById('create').onclick = () => {
			const textbox = document.getElementById('count');
			const count = parseInt(textbox.value, 10);
			parent.postMessage(
				{ pluginMessage: { type: 'create-rectangles', count } },
				'*'
			);
		};

		document.getElementById('cancel').onclick = () => {
			parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
		};
	</script>
	<script type="module">
		import { loop } from './helpers.js';

		let interval;

		const VERIFY_ID_HTTPS =
			'https://us-central1-magical-blocks.cloudfunctions.net/figmaAuth-verifyIDToken';

		function verifyIDToken(idToken) {
			const xmlHTTP = new XMLHttpRequest();
			xmlHTTP.onreadystatechange = function () {
				console.log('updating');
				if (xmlHTTP.readyState === 4) {
					if (xmlHTTP.status === 200) {
						console.log(
							'response : ',
							JSON.parse(xmlHTTP.response)
						);
					} else {
						callback();
					}
				}
			};
			xmlHTTP.open('GET', `${VERIFY_ID_HTTPS}/?state=${idToken}`, true);
			xmlHTTP.send(null);
		}

		// document.getElementById('signin').onclick = async () => {
		// 	console.log('clicked here asdfasd');
		// };

		document.getElementById('signin').onclick = async () => {
			try {
				console.log('clicked here blach');
				// interval = setInterval(loop, 1000);
				console.log('verify id token');
				await verifyIDToken('12345');

				// setTimeout(() => {
				// 	clearInterval(interval);
				// }, 10000);
			} catch (e) {
				console.error(e);
			}
		};
	</script>
</html>
